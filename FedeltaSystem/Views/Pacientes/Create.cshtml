@model FedeltaSystem.Models.tblPacientes

@{
    ViewBag.Title = "Agregar";
}

<div class="row content container-fluid">
    <div class="panel panel-primary">
        <div class="panel-heading text-center"><h5>EXPEDIENTE</h5></div>
        <div class="panel-body bg-gray">
            <div class="form-group">
                <label class="control-label col-md-2">Número de Expediente</label>
                <div class="col-md-4">
                    <input class="form-control" type="number" name="NumExpediente" id="NumExpediente" value="" placeholder="Ingrese un Número" />
                </div>
                <label class="control-label col-md-2">Fecha Creación</label>
                <div class="col-md-4">
                    <input class="form-control" type="date" name="Fecha" id="Fecha" value="" />
                </div>
            </div>
        </div>
    </div>
    <div class="panel panel-primary">
        <div class="panel-heading text-center"><h4>CONTROL DE PACIENTES</h4></div>
        <div class="panel-body bg-gray">

            @using (Html.BeginForm())
            {
                @Html.AntiForgeryToken()

                <div class="form-horizontal">

                    @Html.ValidationSummary(true, "", new { @class = "text-danger" })
                    <div class="form-group">
                        <label class="control-label col-md-2">Nombre del Paciente</label>
                        <div class="col-md-10">
                            @Html.EditorFor(model => model.NombrePaciente, new { htmlAttributes = new { @class = "form-control" } })
                            @Html.ValidationMessageFor(model => model.NombrePaciente, "", new { @class = "text-danger" })
                        </div>
                    </div>

                    <div class="form-group">
                        @Html.LabelFor(model => model.Edad, htmlAttributes: new { @class = "control-label col-md-2" })
                        <div class="col-md-10">
                            @Html.EditorFor(model => model.Edad, new { htmlAttributes = new { @class = "form-control" } })
                            @Html.ValidationMessageFor(model => model.Edad, "", new { @class = "text-danger" })
                        </div>
                    </div>

                    <div class="form-group">
                        @Html.LabelFor(model => model.Sexo, htmlAttributes: new { @class = "control-label col-md-2" })
                        <div class="col-md-10">
                            <select name="Sexo" class="form-control">
                                <option value="">Seleccione</option>
                                <option value="Macho">Macho</option>
                                <option value="Hembra">Hembra</option>
                            </select>
                            @Html.ValidationMessageFor(model => model.Sexo, "", new { @class = "text-danger" })
                        </div>
                    </div>

                    <div class="form-group">
                        @Html.LabelFor(model => model.Raza, htmlAttributes: new { @class = "control-label col-md-2" })
                        <div class="col-md-10">
                            @Html.EditorFor(model => model.Raza, new { htmlAttributes = new { @class = "form-control" } })
                            @Html.ValidationMessageFor(model => model.Raza, "", new { @class = "text-danger" })
                        </div>
                    </div>

                    <div class="form-group">
                        @Html.LabelFor(model => model.Especie, htmlAttributes: new { @class = "control-label col-md-2" })
                        <div class="col-md-10">
                            <select name="Especie" class="form-control">
                                <option value="">Seleccione</option>
                                <option value="Canino">Canino</option>
                                <option value="Felino">Felino</option>
                                <option value="Aves">Aves</option>
                                <option value="Roedores">Roedores</option>
                                <option value="Reptiles">Reptiles</option>
                            </select>
                            @Html.ValidationMessageFor(model => model.Especie, "", new { @class = "text-danger" })
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="control-label col-md-2">Nombre del Responsable</label>
                        <div class="col-md-10">
                            @Html.DropDownList("IdResponsable", null, htmlAttributes: new { @class = "form-control" })
                            @Html.ValidationMessageFor(model => model.IdResponsable, "", new { @class = "text-danger" })
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="col-md-offset-2 col-md-10">
                            <input type="button" value="Guardar" name="btnGuardar" id="btnGuardar" class="btn btn-primary" />
                        </div>
                    </div>
                </div>
            }


        </div>
    </div>
    <div>
        @Html.ActionLink(" Atras", "Index", null, new { @class = "fa fa-mail-reply btn btn-success" })
    </div>
</div>
@section EnvioDatos{
    <script>
         $("#btnGuardar").click(function () {
            var NombrePaciente = $("#NombrePaciente").val();
            var Edad = $("#Edad").val();
            var Sexo = $("#Sexo").val();
            var Raza = $("#Raza").val();
             var Especie = $("#Raza").val();
             if (NombrePaciente == "" || Especie == "") {
                 alert("Faltan Datos del Paciente")
             }
            else {
                $.ajaxSetup({ async: false });
                //cargando datos tabla primaria
                 var urlPaciente = '@Url.Action("CrearPaciente", "Pacientes")';
                 var dataPaciente = { NombrePaciente: NombrePaciente, Edad: Edad, Sexo: Sexo, Raza: Raza, Especie: Especie };
                    $.post(urlPaciente, dataPaciente)
                        .done(function (data) {
                            // alert("Compra Creada con exito")
                        })
                        .fail(function (data) {
                            console.log("Error: " + data.responseText);
                        }).
                        always(function () {
                        });
            //creando detalleCompra
            var NumExpediente = $("#NumExpediente").val();
            var Fecha = $("#Fecha").val();
                 if (NumExpediente == "" || Fecha == "") {
                     alert("Faltan Datos del Expediente")
                 }
                 else {
                     $.ajaxSetup({ async: false });
                     //cargando datos tabla primaria
                     var urlExpe = '@Url.Action("CrearExpediente", "Pacientes")';
                     var dataExpe = { NumExpediente: NumExpediente, Fecha: Fecha };
                     $.post(urlExpe, dataExpe)
                         .done(function (data) {
                             // alert("Compra Creada con exito")
                         })
                         .fail(function (data) {
                             console.log("Error: " + data.responseText);
                         }).
                         always(function () {
                         });
                 }
                var url = '@Url.Action("Index", "Pacientes")';
                $(location).attr('href', url);
            }
        });
    </script>
}